package main

import (
	"fmt"
)

func main() {
	// Download the file
	url := "https://github.com/CVEProject/cvelistV5/archive/refs/heads/main.zip"
	filePath := "./data/downloads/cve_data.zip"

	fmt.Println("Downloading file...")
	if err := downloadFile(url, filePath); err != nil {
		panic(err)
	}
	fmt.Println("File downloaded successfully")

	// Extract the file (unzip)
	src := "./data/downloads/cve_data.zip"
	dest := "./data/extracted"

	fmt.Println("Unzipping ", src, " to ", dest)
	if err := extractZip(src, dest); err != nil {
		panic(err)
	}
	fmt.Println("File unzipped successfully")

	// Process the extracted files
	var basePath = "./data/extracted"
	
	fmt.Println("Processing files...")
	db, err := ConnectDB()
	if err != nil {
		fmt.Printf("Error connecting to the database: %v\n", err)
		return
	}
	defer db.Close()

	if err := traverseAndStoreJSONFiles(db, basePath); err != nil {
		fmt.Printf("Error processing files: %v\n", err)
	}
	fmt.Println("Files processed successfully")
}
